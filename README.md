# SerialPort

[![Build Status](https://travis-ci.org/deviator/serialport.svg?branch=master)](https://travis-ci.org/deviator/serialport)
[![Build status](https://ci.appveyor.com/api/projects/status/64m852qc8j3re1y1?svg=true)](https://ci.appveyor.com/project/deviator/serialport)
[![codecov](https://codecov.io/gh/deviator/serialport/branch/master/graph/badge.svg)](https://codecov.io/gh/deviator/serialport)
[![Dub](https://img.shields.io/dub/v/serialport.svg)](http://code.dlang.org/packages/serialport)
[![Downloads](https://img.shields.io/dub/dt/serialport.svg)](http://code.dlang.org/packages/serialport)
[![License](https://img.shields.io/dub/l/serialport.svg)](http://code.dlang.org/packages/serialport)

[Docs](http://serialport.dpldocs.info/serialport.html) generated by [adrdox](https://github.com/adamdruppe/adrdox).

Library provides simple work with serial port for Linux, Windows and MacOS.

### Simple usage

```d
auto com = new SerialPortBlk("/dev/ttyUSB0", 19200);

// setting parameters example
com.config = SPConfig(9600, DataBits.data8, Parity.none, StopBits.one)
com.set(19200).set(DataBits.data8);
com.stopBits = StopBits.two;
// set 9600 baudrate, 8 data bits, no parity and one stop bit
com.set("9600:8N1");

auto cnt = com.write(someDataArray);
// cnt must be equal someDataArray.length

// res1 is slice of bufferForReading with readed data
auto res1 = com.read(bufferForReading);
```

`SerialPortNonBlk` provides non-blocking `read` (immediatlly return data in system serial port buffer)
and `write` (return writed bytes count at the first onset).

**Warning: unix systems allow only standard speeds**
**[0, 50, 75, 110, 134, 150, 200, 300, 600, 1200, 1800, 2400, 4800, 9600, 19200, 38400, 57600, 115200, 230400]**

### Example: [monitor](example/monitor)

If you want use read/write loops in fibers you can use `SerialPortFR` class.

```d
//                                                      vibe.core.sleep for example
auto com = new SerialPortFR("/dev/ttyUSB0", "9600:8N1", sleepDelegate);

//                            write timeout
com.writeLoop(someDataArray, 500.dur!"usecs");

//                                          read timeout    frame end gap
auto res2 = com.readLoop(bufferForReading, 500.dur!"msecs", 20.dur!"msecs");
```

At expiration of write timeout throws `TimeoutException`.

At expiration of read timeout throws `TimeoutException` if no bytes readed.
If readed bytes count != 0 wait frame end gap and if no new bytes return readed.

Reading and writing loops algorithms use `Fiber.yield` if available,
or `Thread.yield` otherwise. If you want redefine this behavior, you can set
`void delegate() yieldFunc` field of `SerialPort` through ctor or directly.